<div class='tbl'>
  <div class='tbl_row'>
    <div class='tbl_data user_show_title'>
	    <%= gravatar_for @user %>
		  <%= "#{@user.fname} #{@user.lname}" %>
			<% if current_user && current_user.admin? %>
				<%= link_to(edit_icon, edit_user_path(@user)) %>
				<%= link_to(chpwd_icon, edit_user_path(@user) + "?chpwd=1") %>
			<% end %>
		</div>
	</div>
	<div class='tbl_row'>
    <div class='tbl_data'>
	    <div class='tbl'>
		    <div class='tbl_row'>
		      <div class='tbl_head'>
			      Phone:
		      </div>
		      <div class='tbl_data'>
		  	    <%= number_to_phone(@user.tel, :delimiter => '.') %>
		      </div>
		    </div>
		    <div class='tbl_row'>
		      <div class='tbl_head'>
		  	    Email:
		      </div>
		      <div class='tbl_data'>
		  	    <%= @user.email %>
		      </div>
		    </div>
		    <div class='tbl_row'>
		      <div class='tbl_head'>
		  	    Address:
		      </div>
		      <div class='tbl_data'>
		  	    <%= "#{@user.address}, #{@user.city}, #{@user.state} #{@user.zip}" %>
		      </div>
		    </div>
	    </div>
	    <div class="user_show_h2">
	      <%= "#{@user.fname}'s Computers" %>
	      <%= link_to(content_tag(:span, "+", :class => "add round"),
	                  new_computer_path + "?user_id=#{@user.id}",
	                  :title => "Register Computer") %>
      </div>
	    <div class='tbl'>
        <% if @user.computers.any? %>
		  	  <div class='tbl_row'>
		  	    <div class='tbl_head'>Make</div>
		        <div class='tbl_head'>Model</div>
		        <div class='tbl_head'>Serial</div>
		        <div class='tbl_head'>Checked In</div>
		        <div class='tbl_head'>Checked Out</div>
		        <div class='tbl_head'>Actions</div>
		  	  </div>
		      <% @user.computers.each do |computer| %>
			      <div class='tbl_row'>
				      <div class='tbl_data'><%= computer.make %></div>
				      <div class='tbl_data'><%= computer.model %></div>
				      <div class='tbl_data'><%= truncate(computer.serial, :length => 10) %></div>
				      <div class='tbl_data'><%= checked_in_at(computer) %></div>
				      <div class='tbl_data'><%= checked_out_at(computer) %></div>
				      <div class='tbl_data'>
				        <%= link_to ticket_icon, new_ticket_path +
				                                 "?user_id=#{@user.id}&computer_id=#{computer.id}" %>
				        <%= link_to(edit_icon, edit_computer_path(computer) + "?user_id=#{@user.id}") %>
				        <%= link_to content_tag(:span, "-", :class => "subtract round"),
				                    computer_path(computer) + "?user_id=#{@user.id}",
				                    :method => :delete,
						                :confirm => "You sure?",
						                :title => "Delete This Computer" %>
				      </div>
			      </div>
		      <% end %>
	      <% else %>
		      <div class='tbl_row'>
		        <div class='tbl_data default'>
			        It looks like you don't have any computers registered yet.
			        Click the green plus icon above to register your computer with us.
			      </div>
		      </div>
	      <% end %>
      </div>
      <div class="user_show_h2"><%= "#{@user.fname}'s Tickets" %></div>
      <div class='tbl'>
      	<% if @user.tickets.any? %>
          <div class='tbl_row'>
          	<div class='tbl_head'>ID</div>
	          <div class='tbl_head'>Model</div>
            <div class='tbl_head'>Issue</div>
            <div class='tbl_head'>Technician</div>
            <div class='tbl_head'>Status</div>
            <div class='tbl_head'>Created</div>
          </div>
          <% @user.tickets.each do |ticket| %>
            <div class='tbl_row row_link'>
            <% [ ticket.id,
	               ticket.computer.model,
	               truncate(ticket.issue),
	               (ticket.technician) ? ticket.technician : "None",
	               (ticket.status.nil?) ? "None" : ticket.status,
	               "#{time_ago_in_words(ticket.created_at)} ago"
	             ].each do |data| %>
	               <%= content_tag(:div, link_to(data, ticket_path(ticket)), :class => 'tbl_data') %>
	             <% end %>
	          </div>
          <% end %>
       	<% else %>
		      <div class='tbl_row'>
		        <div class='tbl_data default'>
			        It looks like you don't have any tickets yet.
			        If you've already registered your computer,
			        click the blue ticket icon above to open a ticket for your computer.
			      </div>
		      </div>
	      <% end %>
      </div>
    </div>
  </div>
</div>